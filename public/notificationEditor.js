(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{138:function(e,t,a){"use strict";var n=a(61),r=a(62);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(a(0)),o=(0,n(a(63)).default)(i.createElement(i.Fragment,null,i.createElement("path",{d:"M6 20h10.78l-10-10H6zm6.44-10L18 15.56V10z",opacity:".3"}),i.createElement("path",{d:"M8.9 6c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1v2h-4.66l2 2H18v5.56l2 2V10c0-1.1-.9-2-2-2h-1V6c0-2.76-2.24-5-5-5-2.32 0-4.26 1.59-4.82 3.74L8.9 6.46V6zM4.41 4.81L3 6.22l2.04 2.04C4.42 8.6 4 9.25 4 10v10c0 1.1.9 2 2 2h12.78l1 1 1.41-1.41L4.41 4.81zM6 20V10h.78l10 10H6z"})),"NoEncryptionTwoTone");t.default=o},139:function(e,t,a){"use strict";var n=a(61),r=a(62);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(a(0)),o=(0,n(a(63)).default)(i.createElement(i.Fragment,null,i.createElement("path",{d:"M4 8.25l7.51 1-7.5-3.22zm.01 9.72l7.5-3.22-7.51 1z",opacity:".3"}),i.createElement("path",{d:"M2.01 3L2 10l15 2-15 2 .01 7L23 12 2.01 3zM4 8.25V6.03l7.51 3.22-7.51-1zm.01 9.72v-2.22l7.51-1-7.51 3.22z"})),"SendTwoTone");t.default=o},163:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a(1),i=a(2),o=(a(7),a(3)),l=a(85),s=a(5),c=a(4),d=n.forwardRef((function(e,t){var a=e.anchorOrigin,s=void 0===a?{vertical:"top",horizontal:"right"}:a,d=e.badgeContent,m=e.children,u=e.classes,p=e.className,g=e.color,h=void 0===g?"default":g,f=e.component,b=void 0===f?"span":f,y=e.invisible,v=e.max,O=void 0===v?99:v,E=e.overlap,w=void 0===E?"rectangular":E,C=e.showZero,j=void 0!==C&&C,x=e.variant,S=void 0===x?"standard":x,k=Object(i.a)(e,["anchorOrigin","badgeContent","children","classes","className","color","component","invisible","max","overlap","showZero","variant"]),z=function(e){var t=n.useRef({});return n.useEffect((function(){t.current=e})),t.current}({anchorOrigin:s,badgeContent:d,color:h,max:O,overlap:w,variant:S}),T=y;null==y&&(0===d&&!j||null==d&&"dot"!==S)&&(T=!0);var K=T?z:e,R=K.anchorOrigin,M=void 0===R?s:R,P=K.badgeContent,I=K.color,N=void 0===I?h:I,$=K.max,L=void 0===$?O:$,H=K.overlap,W=void 0===H?w:H,A=K.variant,B=void 0===A?S:A,D=Object(l.a)(Object(r.a)({},e,{anchorOrigin:M,badgeContent:P,color:N,component:b,invisible:T,max:L,overlap:W,showZero:j,variant:B}),"MuiBadge"),V="";return"dot"!==B&&(V=P>L?"".concat(L,"+"):P),n.createElement(b,Object(r.a)({className:Object(o.a)(u.root,p),ref:t},k),m,n.createElement("span",{className:Object(o.a)(u.badge,u[B],u["anchorOrigin".concat(Object(c.a)(M.vertical)).concat(Object(c.a)(M.horizontal)).concat(Object(c.a)(W))],D,"default"!==N&&u["color".concat(Object(c.a)(N))],T&&u.invisible)},V))})),m=Object(s.a)((function(e){return{root:{position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0},badge:{display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:e.typography.fontFamily,fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.pxToRem(12),minWidth:20,lineHeight:1,padding:"0 6px",height:20,borderRadius:10,zIndex:1,transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.enteringScreen})},colorPrimary:{backgroundColor:e.palette.primary.main,color:e.palette.primary.contrastText},colorSecondary:{backgroundColor:e.palette.secondary.main,color:e.palette.secondary.contrastText},colorError:{backgroundColor:e.palette.error.main,color:e.palette.error.contrastText},dot:{borderRadius:4,height:8,minWidth:8,padding:0},standard:{},anchorOriginTopRightRectangular:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%","&$invisible":{transform:"scale(0) translate(50%, -50%)"}},anchorOriginBottomRightRectangular:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%","&$invisible":{transform:"scale(0) translate(50%, 50%)"}},anchorOriginTopLeftRectangular:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%","&$invisible":{transform:"scale(0) translate(-50%, -50%)"}},anchorOriginBottomLeftRectangular:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%","&$invisible":{transform:"scale(0) translate(-50%, 50%)"}},anchorOriginTopRightCircular:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%","&$invisible":{transform:"scale(0) translate(50%, -50%)"}},anchorOriginBottomRightCircular:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%","&$invisible":{transform:"scale(0) translate(50%, 50%)"}},anchorOriginTopLeftCircular:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%","&$invisible":{transform:"scale(0) translate(-50%, -50%)"}},anchorOriginBottomLeftCircular:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%","&$invisible":{transform:"scale(0) translate(-50%, 50%)"}},invisible:{transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.leavingScreen})}}}),{name:"MuiBadge"})(d),u=a(84),p=a(158),g=a(118),h=a(162),f=a(155),b=a(139),y=a.n(b),v=a(126),O=a.n(v),E=a(138),w=a.n(E),C=a(128),j=a(18);const x=/^https?:\/\/[^\s/$.?#].[^\s]*$/,S=/^\[([\w\s]*)\]\((https?:\/\/[^\s/$.?#].[^\s]*)\)(,\s\[([\w\s]*)\]\((https?:\/\/[^\s/$.?#].[^\s]*)\))?$/,k=Object(s.a)(e=>({badge:{right:-15,top:12}}))(m);function z(e){const t=Object(n.useMemo)(()=>{if(""!==e.actions){if(x.test(e.actions))return[{title:"open meowtastic weblink",url:e.actions}];if(S.test(e.actions)){const t=e.actions.match(S);let a=[{title:t[1],url:t[2]}];return t[3]&&a.push({title:t[4],url:t[5]}),a}return null}},[e.actions]),[a,r]=Object(n.useState)(!1),[i,o]=Object(n.useState)(null);Object(n.useEffect)(()=>{Object(j.getIdb)().then(e=>e.get("settings","ECDHkeys")).then(t=>t&&e.setPublicKey(t.publicKey))},[]),Object(n.useEffect)(()=>{null===e.publicKey&&r(!1)},[e.publicKey]),Object(n.useEffect)(()=>{o(null),fetch("./getSubscriptions",{method:"post",headers:{"Content-type":"application/json"},body:JSON.stringify({channel:e.channel})}).then(e=>e.json()).then(e=>o(e))},[e.channel]);return n.createElement(n.Fragment,null,n.createElement(u.a,{color:"secondary",variant:"h5",style:{marginBottom:5}},"Create new push notification:"),n.createElement("div",{style:{display:"flex",margin:"10px 0"}},n.createElement(p.a,{label:"title",error:""===e.title,inputProps:{"aria-label":"title"},variant:"outlined",color:"secondary",value:e.title,onChange:t=>e.setTitle(t.target.value),style:{marginRight:8,flexGrow:1},size:"small",fullWidth:!0}),n.createElement(g.a,{title:"Toogles the end-to-end-encryption. If on the message will be encrypted with the public key of every recipient subscriped to the current channel and the stack of encrypted messages is send to our server for push delivery. If off the message will just be send tls encrypted to our server, where it gets processed and encryped for push delivery.",arrow:!0},n.createElement(h.a,{icon:n.createElement(w.a,null),checkedIcon:n.createElement(O.a,null),checked:a,onChange:e=>r(e.target.checked),disabled:!e.publicKey}))),n.createElement(p.a,{label:"body text",inputProps:{"aria-label":"body text"},variant:"outlined",color:"secondary",value:e.body,onChange:t=>e.setBody(t.target.value),size:"small",fullWidth:!0}),n.createElement(p.a,{label:"icon url",error:""!==e.icon&&!x.test(e.icon),inputProps:{"aria-label":"icon url"},variant:"outlined",color:"secondary",value:e.icon,onChange:t=>e.setIcon(t.target.value),style:{margin:"10px 0"},size:"small",fullWidth:!0}),n.createElement(p.a,{label:"image url (optional landscape header, no Firefox support)",error:""!==e.image&&!x.test(e.image),inputProps:{"aria-label":"image url"},variant:"outlined",color:"secondary",value:e.image,onChange:t=>e.setImage(t.target.value),size:"small",fullWidth:!0}),n.createElement(p.a,{label:"weblink buttons: url or [label1](url1), [label2](url2)",error:null===t,inputProps:{"aria-label":"weblink buttons"},variant:"outlined",color:"secondary",value:e.actions,onChange:t=>e.setActions(t.target.value),style:{margin:"10px 0"},size:"small",fullWidth:!0}),n.createElement("div",{style:{display:"flex"}},n.createElement(f.a,{variant:"outlined",color:"secondary",onClick:()=>[e.setTitle,e.setBody,e.setIcon,e.setImage,e.setActions].forEach(e=>e(""))},"Reset"),n.createElement(f.a,{variant:"contained",color:"primary",startIcon:n.createElement(y.a,null),onClick:()=>{let n={title:e.title,body:e.body,icon:e.icon,image:e.image,actions:t,channel:e.channel};if(a){const t=window.crypto.subtle,a=e.channel;n.timestamp=(new Date).getTime(),Promise.all([Object(j.getIdb)().then(e=>e.get("settings","ECDHkeys")).then(e=>t.importKey("jwk",e.privateKey,{name:"ECDH",namedCurve:"P-256"},!1,["deriveKey"])),Promise.all(i.map(e=>t.importKey("jwk",e.ECDHpublicKey,{name:"ECDH",namedCurve:"P-256"},!1,[]).then(t=>({id:e._id,publicKey:t}))))]).then(([e,a])=>Promise.all(a.map(a=>t.deriveKey({name:"ECDH",namedCurve:"P-256",public:a.publicKey},e,{name:"AES-GCM",length:256},!1,["encrypt"]).then(e=>{const r=window.crypto.getRandomValues(new Uint8Array(16));return t.encrypt({name:"AES-GCM",iv:r,tagLength:128},e,(new TextEncoder).encode(JSON.stringify(n))).then(e=>({id:a.id,iv:Array.from(r).map(e=>e.toString(16).padStart(2,"0")).join(""),payload:Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join("")}))})))).then(t=>{const n=t.reduce((t,a)=>(t[a.id]={iv:a.iv,payload:a.payload,publicKey:e.publicKey},t),{});return fetch("./sendE2EENotification",{method:"post",headers:{"Content-type":"application/json"},body:JSON.stringify({payloads:n,channel:a})})})}else fetch("./sendNotification",{method:"post",headers:{"Content-type":"application/json"},body:JSON.stringify(n)})},style:{flexGrow:1,marginLeft:8},disabled:""!==e.icon&&!x.test(e.icon)||""!==e.image&&!x.test(e.image)||null===t||""===e.title||!i},n.createElement(k,{color:"secondary",badgeContent:null===i?"?":i.length},"Send Notification to #",e.channel))),n.createElement(u.a,{color:"secondary",variant:"h5",style:{margin:"20px 0 10px"}},"Notification preview:"),n.createElement(C.a,{title:e.title,body:e.body,icon:e.icon,image:e.image,actions:t,publicKey:a&&e.publicKey,time:(new Date).getTime(),highlight:!1,inverseTheme:e.inverseTheme}))}t.default=n.memo(z)}}]);